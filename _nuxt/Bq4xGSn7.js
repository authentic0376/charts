var b=Object.defineProperty;var k=(n,i,o)=>i in n?b(n,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[i]=o;var r=(n,i,o)=>k(n,typeof i!="symbol"?i+"":i,o);import{p as F}from"./BtJWWB7g.js";import{G as P,S as m}from"./DEeXZt0h.js";import"./Cut6mXYM.js";import"./dJS4Ob37.js";const N=n=>!!n&&typeof n.x=="number"&&!isNaN(n.x)&&isFinite(n.x)&&typeof n.y=="number"&&!isNaN(n.y)&&isFinite(n.y),x=n=>!!n&&typeof n.x=="number"&&!isNaN(n.x)&&isFinite(n.x)&&typeof n.y=="number"&&!isNaN(n.y)&&isFinite(n.y);class O{constructor(i,o,f){r(this,"p");r(this,"range");r(this,"scale");if(!i)throw new Error("GridRenderer requires a valid p5 instance.");this.p=i,this.range=o,this.scale=f}isValidVector(i){return x(i)}display(i,o,f,t){if(!this.isValidVector(i)||!this.isValidVector(o))return;const v=this.p;v.stroke(f),v.strokeWeight(t),v.noFill();try{for(let e=-this.range;e<=this.range;e++){const _=i.copy().mult(e);if(!this.isValidVector(_))continue;const y=o.copy().mult(-this.range);if(!this.isValidVector(y))continue;const g=o.copy().mult(this.range);if(!this.isValidVector(g))continue;const E=F.Vector.add(_,y);if(!this.isValidVector(E))continue;const c=F.Vector.add(_,g);if(!this.isValidVector(c))continue;v.line(E.x*this.scale,E.y*this.scale,c.x*this.scale,c.y*this.scale);const l=i.copy().mult(-this.range);if(!this.isValidVector(l))continue;const d=i.copy().mult(this.range);if(!this.isValidVector(d))continue;const s=o.copy().mult(e);if(!this.isValidVector(s))continue;const h=F.Vector.add(l,s);if(!this.isValidVector(h))continue;const a=F.Vector.add(d,s);this.isValidVector(a)&&v.line(h.x*this.scale,h.y*this.scale,a.x*this.scale,a.y*this.scale)}}catch(e){console.error("Error during GridRenderer display:",e)}}}class M{constructor(){r(this,"p5Instance",null);r(this,"container",null);r(this,"width",0);r(this,"height",0);r(this,"canvas",null);r(this,"vxRef",null);r(this,"vyRef",null);r(this,"i_hat");r(this,"j_hat");r(this,"e1");r(this,"e2");r(this,"epsilon1");r(this,"epsilon2");r(this,"v_std_vec");r(this,"v_std_coords",null);r(this,"v_primal_coords",null);r(this,"v_dual_coords",null);r(this,"standardGrid");r(this,"primalGrid");r(this,"dualGrid")}setVectorRefs(i,o){this.vxRef=i,this.vyRef=o}async setup(i,o,f){this.container=i,this.width=o,this.height=f;const t=this,v=e=>{const _=()=>{e.translate(e.width/2,e.height/2),e.scale(1,-1)},y=(c,l,d)=>{if(x(c)){e.push();try{const s=c.copy().mult(m);if(!x(s)){e.pop();return}e.stroke(l),e.strokeWeight(2.5),e.fill(l),e.line(0,0,s.x,s.y);const h=e.atan2(s.y,s.x);if(isNaN(h)||!isFinite(h)){e.pop();return}e.translate(s.x,s.y),e.rotate(h);const a=7;e.translate(-a*1.2,0),e.triangle(0,a/2,0,-a/2,a,0),e.rotate(-h);const u=a*2,w=u*e.cos(h),G=u*e.sin(h);if(Math.abs(s.x)>.1||Math.abs(s.y)>.1){const I=w,R=G;e.translate(I,R),e.scale(1,-1),e.noStroke(),e.fill(l),e.textSize(16),e.textAlign(e.CENTER,e.CENTER),e.text(d,0,0)}else e.scale(1,-1)}catch(s){console.error(`Error drawing basis vector ${d}:`,s)}finally{e.pop()}}},g=(c,l,d,s,h)=>{if(!(!x(c)||!l||isNaN(l.x)||isNaN(l.y))){e.push();try{const a=c.copy().mult(m);if(!x(a)){e.pop();return}e.stroke(h),e.strokeWeight(2.5),e.fill(h),e.line(0,0,a.x,a.y);const u=e.atan2(a.y,a.x);if(isNaN(u)||!isFinite(u)){e.pop();return}e.translate(a.x,a.y),e.rotate(u);const w=7;e.translate(-w*1.2,0),e.triangle(0,w/2,0,-w/2,w,0),e.rotate(-u),e.noStroke(),e.fill(h),e.textSize(14);const G=15,I=-5,R=16,T=e.createVector().set(G,I).copy().rotate(u);e.scale(1,-1);const p=T.x;let V=-T.y;u>-e.PI*.45&&u<e.PI*.45?e.textAlign(e.LEFT,e.BOTTOM):u>e.PI*.55||u<-e.PI*.55?e.textAlign(e.RIGHT,e.BOTTOM):u>=e.PI*.45?(e.textAlign(e.CENTER,e.BOTTOM),V-=R):(e.textAlign(e.CENTER,e.TOP),V+=R),e.text(`v,ω(${l.x.toFixed(1)}, ${l.y.toFixed(1)})`,p,V),d&&isFinite(d.x)&&isFinite(d.y)&&(V-=R,e.text(`v'(${d.x.toFixed(1)}, ${d.y.toFixed(1)})`,p,V)),s&&isFinite(s.x)&&isFinite(s.y)&&(V-=R,e.text(`ω'(${s.x.toFixed(1)}, ${s.y.toFixed(1)})`,p,V))}catch(a){console.error("Error drawing data vector:",a)}finally{e.pop()}}},E=()=>{if(!t.vxRef||!t.vyRef||!t.p5Instance){console.warn("Vector Refs or p5 instance not set for mouse press.");return}const c=t.p5Instance.mouseX,l=t.p5Instance.mouseY;if(c<0||c>t.width||l<0||l>t.height)return;let d=c-t.width/2,s=t.height/2-l;d=d/m,s=s/m,t.vxRef.value=d,t.vyRef.value=s};e.setup=()=>{if(!t.container){console.error("P5BasisRenderer: Container not set before setup!");return}t.canvas=e.createCanvas(t.width,t.height),t.canvas.parent(t.container),t.canvas.mousePressed(E),t.i_hat=e.createVector().set(1,0),t.j_hat=e.createVector().set(0,1),t.e1=e.createVector().set(1,0),t.e2=e.createVector().set(0,1),t.epsilon1=e.createVector().set(1,0),t.epsilon2=e.createVector().set(0,1),t.v_std_vec=e.createVector().set(1,1),t.v_std_coords={x:1,y:1},t.v_primal_coords={x:1,y:1},t.v_dual_coords={x:1,y:1},t.standardGrid=new O(e,P,m),t.primalGrid=new O(e,P,m),t.dualGrid=new O(e,P,m),e.describe("Interactive 2D basis transformation visualization. Click on the canvas to set the green vector 'v'."),e.noLoop()},e.draw=()=>{if(!(!t.i_hat||!t.j_hat||!t.e1||!t.e2||!t.epsilon1||!t.epsilon2||!t.v_std_vec||!t.standardGrid||!t.primalGrid||!t.dualGrid))try{e.background(255),_(),t.standardGrid.display(t.i_hat,t.j_hat,e.color(200),1),x(t.e1)&&x(t.e2)&&t.primalGrid.display(t.e1,t.e2,e.color(0,0,255,150),1.5),x(t.epsilon1)&&x(t.epsilon2)&&t.dualGrid.display(t.epsilon1,t.epsilon2,e.color(255,0,0,150),1.5),y(t.e1,e.color(0,0,255),"e₁"),y(t.e2,e.color(0,0,255),"e₂"),y(t.epsilon1,e.color(255,0,0),"ε¹"),y(t.epsilon2,e.color(255,0,0),"ε²"),g(t.v_std_vec,t.v_std_coords,t.v_primal_coords,t.v_dual_coords,e.color(0,150,0))}catch(c){console.error("Error in p.draw:",c)}finally{e.resetMatrix()}}};try{if(this.p5Instance=new F(v),!this.p5Instance)throw new Error("Failed to create p5 instance.")}catch(e){console.error("Failed to initialize P5BasisRenderer:",e),this.p5Instance=null}}draw(i){if(!this.p5Instance||!this.e1||!this.e2||!this.epsilon1||!this.epsilon2||!this.v_std_vec)return;const o=N(i.e1),f=N(i.e2),t=N(i.epsilon1),v=N(i.epsilon2);this.e1.set(o?i.e1.x:NaN,o?i.e1.y:NaN),this.e2.set(f?i.e2.x:NaN,f?i.e2.y:NaN),this.epsilon1.set(t?i.epsilon1.x:NaN,t?i.epsilon1.y:NaN),this.epsilon2.set(v?i.epsilon2.x:NaN,v?i.epsilon2.y:NaN);const e=N(i.v_std),_=N(i.v_primal),y=N(i.v_dual);this.v_std_vec.set(e?i.v_std.x:NaN,e?i.v_std.y:NaN),this.v_std_coords=e?{...i.v_std}:null,this.v_primal_coords=_?{...i.v_primal}:null,this.v_dual_coords=y?{...i.v_dual}:null;try{this.p5Instance.redraw()}catch(g){console.error("Error calling p5.redraw:",g)}}destroy(){if(this.p5Instance)try{this.canvas&&this.canvas.mousePressed(null),this.p5Instance.remove(),console.log("P5BasisRenderer destroyed.")}catch(i){console.error("Error removing p5 instance:",i)}finally{this.p5Instance=null,this.canvas=null}this.container=null,this.vxRef=null,this.vyRef=null,this.i_hat=void 0,this.j_hat=void 0,this.e1=void 0,this.e2=void 0,this.epsilon1=void 0,this.epsilon2=void 0,this.v_std_vec=void 0,this.standardGrid=void 0,this.primalGrid=void 0,this.dualGrid=void 0,this.v_std_coords=null,this.v_primal_coords=null,this.v_dual_coords=null}resize(i,o){if(this.width=i,this.height=o,this.p5Instance)try{this.p5Instance.resizeCanvas(this.width,this.height),this.p5Instance.redraw()}catch(f){console.error("Error resizing p5 canvas:",f)}}}export{M as P5BasisRenderer};
