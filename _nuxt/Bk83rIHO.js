var I=Object.defineProperty;var _=(e,i,s)=>i in e?I(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s;var n=(e,i,s)=>_(e,typeof i!="symbol"?i+"":i,s);import{p as m}from"./BtJWWB7g.js";import{G as w,S as g}from"./DcPakuHs.js";import"./dktxTqiW.js";const x=e=>!!e&&typeof e.x=="number"&&!isNaN(e.x)&&isFinite(e.x)&&typeof e.y=="number"&&!isNaN(e.y)&&isFinite(e.y),o=e=>!!e&&typeof e.x=="number"&&!isNaN(e.x)&&isFinite(e.x)&&typeof e.y=="number"&&!isNaN(e.y)&&isFinite(e.y);class G{constructor(i,s,h){n(this,"range");n(this,"scale");n(this,"p");if(!i)throw new Error("GridRenderer requires a valid p5 instance.");this.p=i,this.range=s,this.scale=h}isValidVector(i){return o(i)}display(i,s,h,f){if(!(!this.isValidVector(i)||!this.isValidVector(s))){this.p.stroke(h),this.p.strokeWeight(f),this.p.noFill();for(let t=-this.range;t<=this.range;t++){const y=i.copy().mult(t);if(!this.isValidVector(y))continue;const a=s.copy().mult(-this.range);if(!this.isValidVector(a))continue;const l=m.Vector.add(y,a);if(!this.isValidVector(l))continue;const V=s.copy().mult(this.range);if(!this.isValidVector(V))continue;const p=m.Vector.add(y,V);if(!this.isValidVector(p))continue;this.p.line(l.x*this.scale,l.y*this.scale,p.x*this.scale,p.y*this.scale);const r=i.copy().mult(-this.range);if(!this.isValidVector(r))continue;const c=i.copy().mult(this.range);if(!this.isValidVector(c))continue;const d=s.copy().mult(t);if(!this.isValidVector(d))continue;const N=m.Vector.add(r,d);if(!this.isValidVector(N))continue;const u=m.Vector.add(c,d);this.isValidVector(u)&&this.p.line(N.x*this.scale,N.y*this.scale,u.x*this.scale,u.y*this.scale)}}}}class k{constructor(){n(this,"p5Instance",null);n(this,"container",null);n(this,"width",0);n(this,"height",0);n(this,"i_hat");n(this,"j_hat");n(this,"e1");n(this,"e2");n(this,"epsilon1");n(this,"epsilon2");n(this,"standardGrid");n(this,"primalGrid");n(this,"dualGrid")}async setup(i,s,h){this.container=i,this.width=s,this.height=h;const f=t=>{const y=()=>{t.translate(t.width/2,t.height/2),t.scale(1,-1)},a=(l,V,p)=>{if(!o(l))return;t.push();const r=l.copy().mult(g);if(!o(r)){t.pop();return}t.stroke(V),t.strokeWeight(2.5),t.fill(V),t.line(0,0,r.x,r.y);const c=t.atan2(r.y,r.x);if(isNaN(c)||!isFinite(c)){t.pop();return}t.translate(r.x,r.y),t.rotate(c);const d=7;t.translate(-8.4,0),t.triangle(0,d/2,0,-3.5,d,0),t.rotate(-c);const u=t.createVector().set(d*1.8,0).rotate(c);if(!o(u)){t.pop();return}t.translate(u.x,u.y),t.scale(1,-1),t.noStroke(),t.fill(V),t.textSize(16),t.textAlign(t.CENTER,t.CENTER),t.text(p,0,0),t.pop()};t.setup=()=>{if(!this.container){console.error("P5BasisRenderer: Container not set before setup!");return}t.createCanvas(this.width,this.height).parent(this.container),this.i_hat=t.createVector().set(1,0),this.j_hat=t.createVector().set(0,1),this.e1=t.createVector().set(1,0),this.e2=t.createVector().set(0,1),this.epsilon1=t.createVector().set(1,0),this.epsilon2=t.createVector().set(0,1),this.standardGrid=new G(t,w,g),this.primalGrid=new G(t,w,g),this.dualGrid=new G(t,w,g),t.describe("Interactive 2D basis transformation visualization showing primal and dual bases and their grids. Handles degenerate cases."),t.noLoop()},t.draw=()=>{!this.i_hat||!this.j_hat||!this.e1||!this.e2||!this.epsilon1||!this.epsilon2||!this.standardGrid||!this.primalGrid||!this.dualGrid||(t.background(255),y(),this.standardGrid.display(this.i_hat,this.j_hat,t.color(200),1),o(this.e1)&&o(this.e2)?(this.primalGrid.display(this.e1,this.e2,t.color(0,0,255,150),1.5),a(this.e1,t.color(0,0,255),"e₁"),a(this.e2,t.color(0,0,255),"e₂")):(o(this.e1)&&a(this.e1,t.color(0,0,255),"e₁"),o(this.e2)&&a(this.e2,t.color(0,0,255),"e₂")),o(this.epsilon1)&&o(this.epsilon2)&&(this.dualGrid.display(this.epsilon1,this.epsilon2,t.color(255,0,0,150),1.5),a(this.epsilon1,t.color(255,0,0),"ε¹"),a(this.epsilon2,t.color(255,0,0),"ε²")),t.resetMatrix())}};this.p5Instance=new m(f)}draw(i){if(!this.p5Instance||!this.e1||!this.e2||!this.epsilon1||!this.epsilon2)return;const s=x(i.e1),h=x(i.e2),f=x(i.epsilon1),t=x(i.epsilon2);this.e1.set(s?i.e1.x:NaN,s?i.e1.y:NaN),this.e2.set(h?i.e2.x:NaN,h?i.e2.y:NaN),this.epsilon1.set(f?i.epsilon1.x:NaN,f?i.epsilon1.y:NaN),this.epsilon2.set(t?i.epsilon2.x:NaN,t?i.epsilon2.y:NaN),this.p5Instance&&this.p5Instance.redraw()}destroy(){this.p5Instance&&(this.p5Instance.remove(),this.p5Instance=null,console.log("P5BasisRenderer destroyed.")),this.container=null}resize(i,s){this.width=i,this.height=s,this.p5Instance&&(this.p5Instance.resizeCanvas(this.width,this.height),this.p5Instance.redraw())}}export{k as P5BasisRenderer};
