var E=Object.defineProperty;var I=(e,t,s)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var n=(e,t,s)=>I(e,typeof t!="symbol"?t+"":t,s);import{p as m}from"./BtJWWB7g.js";import{G,S as g}from"./cLLT0iWR.js";import"./iGFIcCMA.js";import"./Df-FfOKq.js";const x=e=>!!e&&typeof e.x=="number"&&!isNaN(e.x)&&isFinite(e.x)&&typeof e.y=="number"&&!isNaN(e.y)&&isFinite(e.y),r=e=>!!e&&typeof e.x=="number"&&!isNaN(e.x)&&isFinite(e.x)&&typeof e.y=="number"&&!isNaN(e.y)&&isFinite(e.y);class _{constructor(t,s,a){n(this,"p");n(this,"range");n(this,"scale");if(!t)throw new Error("GridRenderer requires a valid p5 instance.");this.p=t,this.range=s,this.scale=a}isValidVector(t){return r(t)}display(t,s,a,d){if(!this.isValidVector(t)||!this.isValidVector(s))return;const i=this.p;i.stroke(a),i.strokeWeight(d),i.noFill();for(let u=-this.range;u<=this.range;u++){const h=t.copy().mult(u);if(!this.isValidVector(h))continue;const f=s.copy().mult(-this.range);if(!this.isValidVector(f))continue;const V=s.copy().mult(this.range);if(!this.isValidVector(V))continue;const y=m.Vector.add(h,f);if(!this.isValidVector(y))continue;const o=m.Vector.add(h,V);if(!this.isValidVector(o))continue;i.line(y.x*this.scale,y.y*this.scale,o.x*this.scale,o.y*this.scale);const l=t.copy().mult(-this.range);if(!this.isValidVector(l))continue;const p=t.copy().mult(this.range);if(!this.isValidVector(p))continue;const N=s.copy().mult(u);if(!this.isValidVector(N))continue;const c=m.Vector.add(l,N);if(!this.isValidVector(c))continue;const w=m.Vector.add(p,N);this.isValidVector(w)&&i.line(c.x*this.scale,c.y*this.scale,w.x*this.scale,w.y*this.scale)}}}class S{constructor(){n(this,"p5Instance",null);n(this,"container",null);n(this,"width",0);n(this,"height",0);n(this,"i_hat");n(this,"j_hat");n(this,"e1");n(this,"e2");n(this,"epsilon1");n(this,"epsilon2");n(this,"standardGrid");n(this,"primalGrid");n(this,"dualGrid")}async setup(t,s,a){this.container=t,this.width=s,this.height=a;const d=i=>{const u=()=>{i.translate(i.width/2,i.height/2),i.scale(1,-1)},h=(f,V,y)=>{if(!r(f))return;i.push();const o=f.copy().mult(g);if(!r(o)){i.pop();return}i.stroke(V),i.strokeWeight(2.5),i.fill(V),i.line(0,0,o.x,o.y);const l=i.atan2(o.y,o.x);if(isNaN(l)||!isFinite(l)){i.pop();return}i.translate(o.x,o.y),i.rotate(l);const p=7;i.translate(-8.4,0),i.triangle(0,p/2,0,-3.5,p,0),i.rotate(-l);const c=i.createVector().set(p*1.8,0).rotate(l);if(!r(c)){i.pop();return}i.translate(c.x,c.y),i.scale(1,-1),i.noStroke(),i.fill(V),i.textSize(16),i.textAlign(i.CENTER,i.CENTER),i.text(y,0,0),i.pop()};i.setup=()=>{if(!this.container){console.error("P5BasisRenderer: Container not set before setup!");return}i.createCanvas(this.width,this.height).parent(this.container),this.i_hat=i.createVector().set(1,0),this.j_hat=i.createVector().set(0,1),this.e1=i.createVector().set(1,0),this.e2=i.createVector().set(0,1),this.epsilon1=i.createVector().set(1,0),this.epsilon2=i.createVector().set(0,1),this.standardGrid=new _(i,G,g),this.primalGrid=new _(i,G,g),this.dualGrid=new _(i,G,g),i.describe("Interactive 2D basis transformation visualization showing primal and dual bases and their grids. Handles degenerate cases."),i.noLoop()},i.draw=()=>{!this.i_hat||!this.j_hat||!this.e1||!this.e2||!this.epsilon1||!this.epsilon2||!this.standardGrid||!this.primalGrid||!this.dualGrid||(i.background(255),u(),this.standardGrid.display(this.i_hat,this.j_hat,i.color(200),1),r(this.e1)&&r(this.e2)&&this.primalGrid.display(this.e1,this.e2,i.color(0,0,255,150),1.5),r(this.e1)&&h(this.e1,i.color(0,0,255),"e₁"),r(this.e2)&&h(this.e2,i.color(0,0,255),"e₂"),r(this.epsilon1)&&r(this.epsilon2)&&this.dualGrid.display(this.epsilon1,this.epsilon2,i.color(255,0,0,150),1.5),r(this.epsilon1)&&h(this.epsilon1,i.color(255,0,0),"ε¹"),r(this.epsilon2)&&h(this.epsilon2,i.color(255,0,0),"ε²"),i.resetMatrix())}};this.p5Instance=new m(d)}draw(t){if(!this.p5Instance||!this.e1||!this.e2||!this.epsilon1||!this.epsilon2)return;const s=x(t.e1),a=x(t.e2),d=x(t.epsilon1),i=x(t.epsilon2);this.e1.set(s?t.e1.x:NaN,s?t.e1.y:NaN),this.e2.set(a?t.e2.x:NaN,a?t.e2.y:NaN),this.epsilon1.set(d?t.epsilon1.x:NaN,d?t.epsilon1.y:NaN),this.epsilon2.set(i?t.epsilon2.x:NaN,i?t.epsilon2.y:NaN),this.p5Instance.redraw()}destroy(){this.p5Instance&&(this.p5Instance.remove(),this.p5Instance=null,console.log("P5BasisRenderer destroyed.")),this.container=null,this.i_hat=void 0,this.j_hat=void 0,this.e1=void 0,this.e2=void 0,this.epsilon1=void 0,this.epsilon2=void 0,this.standardGrid=void 0,this.primalGrid=void 0,this.dualGrid=void 0}resize(t,s){this.width=t,this.height=s,this.p5Instance&&(this.p5Instance.resizeCanvas(this.width,this.height),this.p5Instance.redraw())}}export{S as P5BasisRenderer};
