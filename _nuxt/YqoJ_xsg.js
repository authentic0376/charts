var P=Object.defineProperty;var b=(r,i,a)=>i in r?P(r,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[i]=a;var s=(r,i,a)=>b(r,typeof i!="symbol"?i+"":i,a);import{p as F}from"./BtJWWB7g.js";import{G as T,S as E}from"./D9_Yu3C0.js";import"./COBHd9is.js";import"./CfQNJ9ne.js";const N=r=>!!r&&typeof r.x=="number"&&!isNaN(r.x)&&isFinite(r.x)&&typeof r.y=="number"&&!isNaN(r.y)&&isFinite(r.y),x=r=>!!r&&typeof r.x=="number"&&!isNaN(r.x)&&isFinite(r.x)&&typeof r.y=="number"&&!isNaN(r.y)&&isFinite(r.y);class p{constructor(i,a,f){s(this,"p");s(this,"range");s(this,"scale");if(!i)throw new Error("GridRenderer requires a valid p5 instance.");this.p=i,this.range=a,this.scale=f}isValidVector(i){return x(i)}display(i,a,f,e){if(!this.isValidVector(i)||!this.isValidVector(a))return;const y=this.p;y.stroke(f),y.strokeWeight(e),y.noFill();try{for(let t=-this.range;t<=this.range;t++){const _=i.copy().mult(t);if(!this.isValidVector(_))continue;const v=a.copy().mult(-this.range);if(!this.isValidVector(v))continue;const g=a.copy().mult(this.range);if(!this.isValidVector(g))continue;const h=F.Vector.add(_,v);if(!this.isValidVector(h))continue;const d=F.Vector.add(_,g);if(!this.isValidVector(d))continue;y.line(h.x*this.scale,h.y*this.scale,d.x*this.scale,d.y*this.scale);const u=i.copy().mult(-this.range);if(!this.isValidVector(u))continue;const o=i.copy().mult(this.range);if(!this.isValidVector(o))continue;const c=a.copy().mult(t);if(!this.isValidVector(c))continue;const n=F.Vector.add(u,c);if(!this.isValidVector(n))continue;const l=F.Vector.add(o,c);this.isValidVector(l)&&y.line(n.x*this.scale,n.y*this.scale,l.x*this.scale,l.y*this.scale)}}catch(t){console.error("Error during GridRenderer display:",t)}}}class D{constructor(){s(this,"p5Instance",null);s(this,"container",null);s(this,"width",0);s(this,"height",0);s(this,"i_hat");s(this,"j_hat");s(this,"e1");s(this,"e2");s(this,"epsilon1");s(this,"epsilon2");s(this,"v_std_vec");s(this,"v_std_coords",null);s(this,"v_primal_coords",null);s(this,"v_dual_coords",null);s(this,"standardGrid");s(this,"primalGrid");s(this,"dualGrid")}async setup(i,a,f){this.container=i,this.width=a,this.height=f;const e=this,y=t=>{const _=()=>{t.translate(t.width/2,t.height/2),t.scale(1,-1)},v=(h,d,u)=>{if(x(h)){t.push();try{const o=h.copy().mult(E);if(!x(o)){t.pop();return}t.stroke(d),t.strokeWeight(2.5),t.fill(d),t.line(0,0,o.x,o.y);const c=t.atan2(o.y,o.x);if(isNaN(c)||!isFinite(c)){t.pop();return}t.translate(o.x,o.y),t.rotate(c);const n=7;t.translate(-n*1.2,0),t.triangle(0,n/2,0,-n/2,n,0),t.rotate(-c);const l=n*2,m=l*t.cos(c),G=l*t.sin(c);if(Math.abs(o.x)>.1||Math.abs(o.y)>.1){const I=m,w=G;t.translate(I,w),t.scale(1,-1),t.noStroke(),t.fill(d),t.textSize(16),t.textAlign(t.CENTER,t.CENTER),t.text(u,0,0)}else t.scale(1,-1)}catch(o){console.error(`Error drawing basis vector ${u}:`,o)}finally{t.pop()}}},g=(h,d,u,o,c)=>{if(!(!x(h)||!d||isNaN(d.x)||isNaN(d.y))){t.push();try{const n=h.copy().mult(E);if(!x(n)){t.pop();return}t.stroke(c),t.strokeWeight(2.5),t.fill(c),t.line(0,0,n.x,n.y);const l=t.atan2(n.y,n.x);if(isNaN(l)||!isFinite(l)){t.pop();return}t.translate(n.x,n.y),t.rotate(l);const m=7;t.translate(-m*1.2,0),t.triangle(0,m/2,0,-m/2,m,0),t.rotate(-l),t.noStroke(),t.fill(c),t.textSize(14);const G=15,I=-5,w=16,R=t.createVector().set(G,I).copy().rotate(l);t.scale(1,-1);const O=R.x;let V=-R.y;l>-t.PI*.45&&l<t.PI*.45?t.textAlign(t.LEFT,t.BOTTOM):l>t.PI*.55||l<-t.PI*.55?t.textAlign(t.RIGHT,t.BOTTOM):l>=t.PI*.45?(t.textAlign(t.CENTER,t.BOTTOM),V-=w):(t.textAlign(t.CENTER,t.TOP),V+=w),t.text(`v,ω(${d.x.toFixed(1)}, ${d.y.toFixed(1)})`,O,V),u&&isFinite(u.x)&&isFinite(u.y)&&(V-=w,t.text(`v'(${u.x.toFixed(1)}, ${u.y.toFixed(1)})`,O,V)),o&&isFinite(o.x)&&isFinite(o.y)&&(V-=w,t.text(`ω'(${o.x.toFixed(1)}, ${o.y.toFixed(1)})`,O,V))}catch(n){console.error("Error drawing data vector:",n)}finally{t.pop()}}};t.setup=()=>{if(!e.container){console.error("P5BasisRenderer: Container not set before setup!");return}t.createCanvas(e.width,e.height).parent(e.container),e.i_hat=t.createVector().set(1,0),e.j_hat=t.createVector().set(0,1),e.e1=t.createVector().set(1,0),e.e2=t.createVector().set(0,1),e.epsilon1=t.createVector().set(1,0),e.epsilon2=t.createVector().set(0,1),e.v_std_vec=t.createVector().set(1,1),e.v_std_coords={x:1,y:1},e.v_primal_coords={x:1,y:1},e.v_dual_coords={x:1,y:1},e.standardGrid=new p(t,T,E),e.primalGrid=new p(t,T,E),e.dualGrid=new p(t,T,E),t.describe("Interactive 2D basis transformation visualization showing primal, dual bases, their grids, and a data vector v with its components in different bases."),t.noLoop()},t.draw=()=>{if(!(!e.i_hat||!e.j_hat||!e.e1||!e.e2||!e.epsilon1||!e.epsilon2||!e.v_std_vec||!e.standardGrid||!e.primalGrid||!e.dualGrid))try{t.background(255),_(),e.standardGrid.display(e.i_hat,e.j_hat,t.color(200),1),x(e.e1)&&x(e.e2)&&e.primalGrid.display(e.e1,e.e2,t.color(0,0,255,150),1.5),x(e.epsilon1)&&x(e.epsilon2)&&e.dualGrid.display(e.epsilon1,e.epsilon2,t.color(255,0,0,150),1.5),v(e.e1,t.color(0,0,255),"e₁"),v(e.e2,t.color(0,0,255),"e₂"),v(e.epsilon1,t.color(255,0,0),"ε¹"),v(e.epsilon2,t.color(255,0,0),"ε²"),g(e.v_std_vec,e.v_std_coords,e.v_primal_coords,e.v_dual_coords,t.color(0,150,0))}catch(h){console.error("Error in p.draw:",h)}finally{t.resetMatrix()}}};try{if(this.p5Instance=new F(y),!this.p5Instance)throw new Error("Failed to create p5 instance.")}catch(t){console.error("Failed to initialize P5BasisRenderer:",t),this.p5Instance=null}}draw(i){if(!this.p5Instance||!this.e1||!this.e2||!this.epsilon1||!this.epsilon2||!this.v_std_vec)return;const a=N(i.e1),f=N(i.e2),e=N(i.epsilon1),y=N(i.epsilon2);this.e1.set(a?i.e1.x:NaN,a?i.e1.y:NaN),this.e2.set(f?i.e2.x:NaN,f?i.e2.y:NaN),this.epsilon1.set(e?i.epsilon1.x:NaN,e?i.epsilon1.y:NaN),this.epsilon2.set(y?i.epsilon2.x:NaN,y?i.epsilon2.y:NaN);const t=N(i.v_std),_=N(i.v_primal),v=N(i.v_dual);this.v_std_vec.set(t?i.v_std.x:NaN,t?i.v_std.y:NaN),this.v_std_coords=t?{...i.v_std}:null,this.v_primal_coords=_?{...i.v_primal}:null,this.v_dual_coords=v?{...i.v_dual}:null;try{this.p5Instance.redraw()}catch(g){console.error("Error calling p5.redraw:",g)}}destroy(){if(this.p5Instance)try{this.p5Instance.remove(),console.log("P5BasisRenderer destroyed.")}catch(i){console.error("Error removing p5 instance:",i)}finally{this.p5Instance=null}this.container=null,this.i_hat=void 0,this.j_hat=void 0,this.e1=void 0,this.e2=void 0,this.epsilon1=void 0,this.epsilon2=void 0,this.v_std_vec=void 0,this.standardGrid=void 0,this.primalGrid=void 0,this.dualGrid=void 0,this.v_std_coords=null,this.v_primal_coords=null,this.v_dual_coords=null}resize(i,a){if(this.width=i,this.height=a,this.p5Instance)try{this.p5Instance.resizeCanvas(this.width,this.height),this.p5Instance.redraw()}catch(f){console.error("Error resizing p5 canvas:",f)}}}export{D as P5BasisRenderer};
